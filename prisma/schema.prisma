generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  name         String
  email        String    @unique
  passwordHash String    @map("password_hash")
  createdAt    DateTime  @default(now()) @map("created_at")
  auditLogs    AuditLog[]
  movements    InventoryMovement[]
}

model AuditLog {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  user       User     @relation(fields: [userId], references: [id])
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id")
  action     String
  reason     String?
  details    String?  // JSON string
  createdAt  DateTime @default(now()) @map("created_at")
}

model Category {
  id        String    @id @default(cuid())
  name      String
  code      String    @unique
  archived  Boolean   @default(false)
  createdAt DateTime  @default(now()) @map("created_at")
  products  Product[]
}

model Product {
  id            String    @id @default(cuid())
  categoryId    String    @map("category_id")
  category      Category  @relation(fields: [categoryId], references: [id])
  name          String
  code          String    @unique
  initialQty    Float     @default(0) @map("initial_qty")
  unitPrice     Float     @default(0) @map("unit_price")
  unit          String
  minStock      Float     @default(0) @map("min_stock")
  imageUrl      String?   @map("image_url")
  archived      Boolean   @default(false)
  createdAt     DateTime  @default(now()) @map("created_at")
  movements     InventoryMovement[]
}

model InventoryMovement {
  id                    String    @id @default(cuid())
  productId             String    @map("product_id")
  product               Product   @relation(fields: [productId], references: [id])
  type                  String    // in | out | adjustment | cancel
  refId                 String?   @map("ref_id")
  refMovement           InventoryMovement?  @relation("RefMovement", fields: [refId], references: [id])
  cancelledByMovementId String?   @map("cancelled_by_id")
  refMovements          InventoryMovement[] @relation("RefMovement")
  docNo                 String    @unique @map("doc_no")
  qty                   Float
  unitPrice             Float     @default(0) @map("unit_price")
  txDate                DateTime  @map("tx_date")
  createdAt             DateTime  @default(now()) @map("created_at")
  note                  String?
  reason                String?
  negativeStockAllowed  Boolean   @default(false) @map("negative_stock_allowed")
  customerTag           String?   @map("customer_tag")
  userId                String?   @map("user_id")
  user                  User?     @relation(fields: [userId], references: [id])
}

model Project {
  id              String        @id @default(cuid())
  name            String
  ownerName       String        @map("owner_name")
  ownerPhone      String        @map("owner_phone")
  agreementAmount Float         @map("agreement_amount")
  downPayment    Float         @default(0) @map("down_payment")
  status         String        @default("open") // open | closed
  startDate       DateTime      @map("start_date")
  note            String?
  closedAt       DateTime?     @map("closed_at")
  createdAt       DateTime      @default(now()) @map("created_at")
  changeOrders   ChangeOrder[]
  payments       Payment[]
  expenses       Expense[]
}

model ChangeOrder {
  id          String    @id @default(cuid())
  projectId   String    @map("project_id")
  project     Project   @relation(fields: [projectId], references: [id])
  description String
  amount      Float
  txDate      DateTime  @map("tx_date")
  note        String?
  fileId      String?   @map("file_id")
  createdAt   DateTime  @default(now()) @map("created_at")
}

model Payment {
  id           String   @id @default(cuid())
  projectId    String   @map("project_id")
  project      Project  @relation(fields: [projectId], references: [id])
  amount       Float
  paymentType  String   @map("payment_type")
  txDate       DateTime @map("tx_date")
  note         String?
  receivedBy   String?  @map("received_by")
  createdAt    DateTime @default(now()) @map("created_at")
}

model Expense {
  id           String    @id @default(cuid())
  projectId    String?   @map("project_id")
  project      Project?  @relation(fields: [projectId], references: [id])
  amount       Float
  expenseItem  String    @map("expense_item")
  expenseType  String    @map("expense_type") // general | project
  paymentType  String    @map("payment_type")
  txDate       DateTime  @map("tx_date")
  note         String?
  createdAt    DateTime  @default(now()) @map("created_at")
}

model Attachment {
  id          String   @id @default(cuid())
  entityType  String   @map("entity_type")
  entityId    String   @map("entity_id")
  fileName    String   @map("file_name")
  mimeType    String   @map("mime_type")
  url         String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
}

model CmsContent {
  id             String   @id @default(cuid())
  slug           String   @unique
  title          String
  body           String?
  metaTitle      String?  @map("meta_title")
  metaDescription String? @map("meta_description")
  updatedAt      DateTime @updatedAt @map("updated_at")
}

model PopularService {
  id          String   @id @default(cuid())
  title       String
  description String?  // Kartta görünen kısa açıklama
  imageUrl    String   @map("image_url")
  link        String?  // İsteğe bağlı tıklanabilir link
  sortOrder   Int      @default(0) @map("sort_order")
  createdAt   DateTime @default(now()) @map("created_at")
}

model ExpenseTemplate {
  id    String @id @default(cuid())
  value String @unique
}

model PaymentTypeTemplate {
  id    String @id @default(cuid())
  value String @unique
}
